# ═══════════════════════════════════════════════════════════════════════════
# CSV Mapping: PSFH Sales Report (Local Food Connect)
# ═══════════════════════════════════════════════════════════════════════════
# 
# Source: Local Food Connect portal export
# File pattern: "psfh test report *.csv"
# 
# Sample row:
#   8/14/25,8/18/25,21 Acres Farm Market,165757,Baba Ganoush,12/ 8 oz,
#   BG072825,MAMN024249,$0.00,$45.00,7,1,$45.00,$0.00,12/ 8 oz,1
# ═══════════════════════════════════════════════════════════════════════════

name: psfh_sales
description: "PSFH/Local Food Connect sales report - actual format"
source_type: csv

# CSV options
delimiter: ","
encoding: utf-8
skip_rows: 0
header_row: 0

# Row filtering
skip_patterns:
  - "^\\s*$"              # Empty rows
  - "^Puget Sound Food Hub"  # Footer label
  - "^,{3,}"              # Row starting with 3+ commas (totals row)

# Required columns
required_columns:
  - Customer Name
  - Product Name
  - Qty

# Column mappings
columns:
  # ─────────────────────────────────────────────────────────────────────────
  # Dates
  # ─────────────────────────────────────────────────────────────────────────
  - source: "Period Start Date"
    target: period_start
    type: date
    format: "%m/%d/%y"

  - source: "Aggregation Date"
    target: aggregation_date
    type: date
    format: "%m/%d/%y"

  # ─────────────────────────────────────────────────────────────────────────
  # Customer
  # ─────────────────────────────────────────────────────────────────────────
  - source: "Customer Name"
    target: customer
    type: string
    required: true

  # ─────────────────────────────────────────────────────────────────────────
  # Order
  # ─────────────────────────────────────────────────────────────────────────
  - source: "Order Number"
    target: order_number
    type: string

  # ─────────────────────────────────────────────────────────────────────────
  # Product
  # ─────────────────────────────────────────────────────────────────────────
  - source: "Product Name"
    target: product_raw
    type: string
    required: true

  # Normalize product name (strip asterisks, standardize)
  - source: "Product Name"
    target: product
    type: string
    transform: uppercase
    strip_chars: "*"

  - source: "Selling Unit"
    target: selling_unit
    type: string

  - source: "VIN"
    target: vin
    type: string

  - source: "Lot #"
    target: lot_number
    type: string

  # ─────────────────────────────────────────────────────────────────────────
  # Quantity & Pricing
  # ─────────────────────────────────────────────────────────────────────────
  - source: "Qty"
    target: quantity
    type: integer
    required: true

  - source: "Pick Qty"
    target: pick_qty
    type: integer

  - source: "Weight"
    target: weight
    type: float

  - source: "Unit Price"
    target: unit_price
    type: currency

  - source: "Deposit"
    target: deposit
    type: currency

  - source: "Total Sales"
    target: total_sales
    type: currency

  - source: "Taxable Sales"
    target: taxable_sales
    type: currency

  - source: "Pick Unit"
    target: pick_unit
    type: string

output_type: dict
